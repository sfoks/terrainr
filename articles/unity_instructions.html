<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Importing terrainr tiles into Unity • terrainr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Importing terrainr tiles into Unity">
<meta property="og:description" content="terrainr">
<meta property="og:image" content="https://mikemahoney218.github.io/terrainr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">terrainr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">A Gentle Introduction to terrainr</a>
    </li>
    <li>
      <a href="../articles/unity_instructions.html">Importing terrainr tiles into Unity</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/mikemahoney218/terrainr">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="unity_instructions_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Importing terrainr tiles into Unity</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikemahoney218/terrainr/blob/master/vignettes/unity_instructions.Rmd"><code>vignettes/unity_instructions.Rmd</code></a></small>
      <div class="hidden name"><code>unity_instructions.Rmd</code></div>

    </div>

    
    
<p>One of the key functions of terrainr is <code>raster_to_raw_tiles</code>, which takes TIFF files and converts them into formats that can be used to create interactive landscape visualizations in the <a href="https://unity.com/">Unity rendering engine</a>. This tutorial assumes you have already downloaded Unity.</p>
<p>This is the entirety of the R code that we’ll be running today; most of this tutorial will be focusing on using Unity. If you aren’t familiar with the functions being used in this chunk, check out the <a href="https://mikemahoney218.github.io/terrainr/articles/overview.html">introductory vignette!</a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mikemahoney218.github.io/terrainr/">terrainr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>

<span class="co"># This will get us data for a 16 km2 area centered on Mt. Marcy,</span>
<span class="co"># in the Adirondack State Park of New York </span>
<span class="va">raw_tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,
                        lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">44.04905</span>, <span class="fl">44.17609</span><span class="op">)</span>, 
                        lng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="op">-</span><span class="fl">74.01188</span>, <span class="op">-</span><span class="fl">73.83493</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/get_bbox.html">get_bbox</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="st">"lat"</span>, lng <span class="op">=</span> <span class="st">"lng"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/get_tiles.html">get_tiles</a></span><span class="op">(</span><span class="va">.</span>, services <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"elevation"</span>, <span class="st">"ortho"</span><span class="op">)</span><span class="op">)</span>

<span class="va">merged_outputs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_rasters.html">merge_rasters</a></span><span class="op">(</span><span class="va">raw_tiles</span><span class="op">$</span><span class="va">`3DEPElevation`</span>, 
                                <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span>, 
                                <span class="va">.</span><span class="op">$</span><span class="va">USGSNAIPPlus</span>, 
                                <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu"><a href="../reference/raster_to_raw_tiles.html">raster_to_raw_tiles</a></span><span class="op">(</span>input_file <span class="op">=</span> <span class="va">x</span>, 
                                          output_prefix <span class="op">=</span> <span class="st">"mt_marcy"</span>, 
                      <span class="co"># This is the maximum side length we can import to Unity</span>
                                          side_length <span class="op">=</span> <span class="fl">4097</span>, 
                                          raw <span class="op">=</span> <span class="va">y</span><span class="op">)</span>,
       <span class="va">merged_outputs</span>,
       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The one thing I’ll point out in the code is that we’re providing two sets of arguments to each of our <code>raster_to_raw_tiles</code> runs: first we provide a heightmap with the argument <code>raw = TRUE</code>, then we rerun the function with our orthoimage and <code>raw = FALSE</code>. The reason here is that we’ll import these objects into Unity differently, so they need to be saved out in different file formats.</p>
<p>Once that code finishes running, you should have about this many files:</p>
<p><img src="files.jpg" width="759"></p>
<p>We can safely ignore or delete all the XML files. Additionally, you’ll notice that you have 3 black PNG files, which are only a few kB in size (versus the roughly 75 MB average of the other files). Our input files weren’t exactly evenly divisible by 4097, so the few extra pixels at the end got split into their own files; feel free to delete those (and their matching .raw counterparts) as well.</p>
<p>So now we’re down to 16 files. Let’s go ahead and open a new Unity project now:</p>
<p><img src="new_unity.jpg" width="473"></p>
<p>Which will spit us out into a brand new scene. Note that you can fly around in the scene by right-clicking and using WASD to navigate, and you can fly faster by holding shift at the same time.</p>
<p><img src="new_scene.jpg" width="858"></p>
<p>Under “Game Object” in the top menu bar, go into the “3D Object” submenu and then click “Terrain” to add a new, blank terrain object to our scene. While the terrain is selected (indicated by an orange border; if it isn’t selected, just click on it) click the “Terrain Settings” menu (the gear icon on the far right) in the “Inspector” menu in the right-hand pane.</p>
<p>Almost all the way at the bottom of “Terrain Settings” is the “Import Raw” button. By clicking that and then selecting our first heightmap – let’s start with <code>mt_marcy_1_1.raw</code> – we can start importing it into Unity. Set resolution, X, and Z to the side_length argument in <code>raster_to_raw_tiles</code>, and Y to the maximum elevation across all your tiles – if you don’t know it, you can find it via <code>raster::cellStats(raster::raster("your_merged_heightmap.tif"), "max)</code>. In our case, it’s about 1629.</p>
<p><img src="heightmap_import.jpg" width="406"></p>
<p>Hit “Import” and voila, you have a terrain tile!</p>
<p>To import the rest, we first need to create new terrain objects. I do this by going to the “Create Neighbor Terrains” menu (under Inspector, the icon of mountains with a plus sign all the way to the left) and adding terrain from there.</p>
<p>The trick here is that, when the red “X” cone points straight left and the blue “Z” cone points straight down, tiles are named following the format <code>prefix_x_y.raw</code> where <code>x</code> and <code>y</code> are the tile’s position in a grid. Our <code>mt_marcy_1_1.raw</code> tile is the top left of the grid, with the rest of the tiles being arranged as so:</p>
<p><img src="tile_arrangement.jpg" width="523"></p>
<p>You’ll have to re-input the resolution for each tile, but X, Y, and Z stay the same. Go ahead and import the rest of our tiles.</p>
<p>Once all your tiles are imported, right click in the “Assets” pane at the bottom of the page and select “Import New Asset”. Go ahead and import all of the 9 PNG files we produced earlier.</p>
<p>Now select that (1,1) terrain tile and go to the “Paint Terrain” menu in the Inspector, next to the Create Neighbor Terrain menu. Under “Edit Terrain Layers”, click “Create Layer”. The image tiles are named following the same pattern as the elevation tiles, so go ahead and select the (1,1) image. Double click the image to confirm.</p>
<p><img src="create_layer.jpg" width="822"></p>
<p>Back in the Inspector, click the image that appeared under “Terrain Layers” and then update the Size values to the same side length as the elevation tiles. This will stretch the texture out so it drapes properly over the landscape.</p>
<p><img src="resize_layer.jpg" width="178"></p>
<p>You’ll want to repeat this for each tile – but make sure you click off the tile you just painted before clicking the next one! Otherwise, you’ll paint that tile with the same orthoimage as you just applied; to undo this, click the offending image under Terrain Layers, then “Edit Terrain Layers,” then “Remove Layer”.</p>
<p>And just like that, your map is painted! You’re now able to fly through your creation or use the rest of Unity’s features to turn your landscape into a full 3D experience.</p>
<p><img src="finished.jpg" width="308"></p>
<p><img src="finished_again.jpg" width="483"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Mahoney.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
