<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A gentle introduction to terrainr • terrainr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="A gentle introduction to terrainr">
<meta property="og:description" content="terrainr">
<meta property="og:image" content="https://mikemahoney218.github.io/terrainr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">terrainr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"></ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/overview.html">A Gentle Introduction to terrainr</a>
    </li>
    <li>
      <a href="../articles/unity_instructions.html">Importing terrainr tiles into Unity</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/mikemahoney218/terrainr">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="overview_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A gentle introduction to terrainr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mikemahoney218/terrainr/blob/master/vignettes/overview.Rmd"><code>vignettes/overview.Rmd</code></a></small>
      <div class="hidden name"><code>overview.Rmd</code></div>

    </div>

    
    
<p>The goal of the terrainr package is to make it easy for users to download geospatial data for points within the United States from the USGS National Map API and then process that data for further analysis, or to produce tiles that can then be imported into the Unity 3D rendering engine to be used as physics objects. This vignette will walk through the core functions available in terrainr and talk about a few quirks of the National Map service and how to work around them.</p>
<p>Let’s load the terrainr package to get started:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mikemahoney218.github.io/terrainr/">terrainr</a></span><span class="op">)</span></code></pre></div>
<p>We’re going to work with data for Mount Elbert today, the highest point in the Rocky Mountain range. I’m just choosing this location for the dramatic scenery; the National Map can be used to retrieve data for the entire United States and much of Canada. Let’s simulate some data for the area right around Mt. Elbert, such as the point data we might get from field data:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mt_elbert_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  lat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span>, min <span class="op">=</span> <span class="fl">39.11144</span>, max <span class="op">=</span> <span class="fl">39.12416</span><span class="op">)</span>,
  lng <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">100</span>, min <span class="op">=</span> <span class="op">-</span><span class="fl">106.4534</span>, max <span class="op">=</span> <span class="op">-</span><span class="fl">106.437</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>Let’s also assign the coordinates for the peak to <code>mt_elbert</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mt_elbert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">39.1178</span>, <span class="op">-</span><span class="fl">106.4452</span><span class="op">)</span></code></pre></div>
<p>Our first step is to get the bounding box that contains our data. This is where our first terrainr function, <code>get_bbox</code>, comes in:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mt_elbert_bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_bbox.html">get_bbox</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">mt_elbert_points</span>, 
                           lat <span class="op">=</span> <span class="st">"lat"</span>, 
                           lng <span class="op">=</span> <span class="st">"lng"</span><span class="op">)</span>
<span class="va">mt_elbert_bbox</span>
<span class="co">#&gt; An object of class "terrainr_bounding_box"</span>
<span class="co">#&gt; Slot "bl":</span>
<span class="co">#&gt; An object of class "terrainr_coordinate_pair"</span>
<span class="co">#&gt; Slot "lat":</span>
<span class="co">#&gt;     lat </span>
<span class="co">#&gt; 39.1115 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "lng":</span>
<span class="co">#&gt;       lng </span>
<span class="co">#&gt; -106.4534 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "tr":</span>
<span class="co">#&gt; An object of class "terrainr_coordinate_pair"</span>
<span class="co">#&gt; Slot "lat":</span>
<span class="co">#&gt;      lat </span>
<span class="co">#&gt; 39.12405 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "lng":</span>
<span class="co">#&gt;       lng </span>
<span class="co">#&gt; -106.4372</span></code></pre></div>
<p><code>get_bbox</code> returns an S4 class (<code>terrainr_bounding_box</code>) that indicates the “bottom left” and “top right” points of the box containing all your points, which is guaranteed to work with all the functions in terrainr. However, there’s no requirement for you to go out of your way to make a <code>terrainr_bounding_box</code> object; any list object that contains the same information will work just as well with all of terrainr’s processing and data retrieval functions.</p>
<p>We can also calculate a bounding box for our single point:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">peak_bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_bbox.html">get_bbox</a></span><span class="op">(</span>lat <span class="op">=</span> <span class="va">mt_elbert</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, 
                      lng <span class="op">=</span> <span class="va">mt_elbert</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">peak_bbox</span>
<span class="co">#&gt; An object of class "terrainr_bounding_box"</span>
<span class="co">#&gt; Slot "bl":</span>
<span class="co">#&gt; An object of class "terrainr_coordinate_pair"</span>
<span class="co">#&gt; Slot "lat":</span>
<span class="co">#&gt;     lat </span>
<span class="co">#&gt; 39.1178 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "lng":</span>
<span class="co">#&gt;       lng </span>
<span class="co">#&gt; -106.4452 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "tr":</span>
<span class="co">#&gt; An object of class "terrainr_coordinate_pair"</span>
<span class="co">#&gt; Slot "lat":</span>
<span class="co">#&gt;     lat </span>
<span class="co">#&gt; 39.1178 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "lng":</span>
<span class="co">#&gt;       lng </span>
<span class="co">#&gt; -106.4452</span></code></pre></div>
<p>But of course, this bounding box doesn’t contain anything other than our single point!</p>
<p>If we want, we can extend the bounding box by a set distance using <code><a href="../reference/addbuff.html">add_bbox_buffer()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/addbuff.html">add_bbox_buffer</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">peak_bbox</span>, 
                distance <span class="op">=</span> <span class="fl">1000</span>,
                distance_unit <span class="op">=</span> <span class="st">"meters"</span><span class="op">)</span>
<span class="co">#&gt; An object of class "terrainr_bounding_box"</span>
<span class="co">#&gt; Slot "bl":</span>
<span class="co">#&gt; An object of class "terrainr_coordinate_pair"</span>
<span class="co">#&gt; Slot "lat":</span>
<span class="co">#&gt;      lat </span>
<span class="co">#&gt; 39.11144 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "lng":</span>
<span class="co">#&gt;       lng </span>
<span class="co">#&gt; -106.4534 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "tr":</span>
<span class="co">#&gt; An object of class "terrainr_coordinate_pair"</span>
<span class="co">#&gt; Slot "lat":</span>
<span class="co">#&gt;      lat </span>
<span class="co">#&gt; 39.12416 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Slot "lng":</span>
<span class="co">#&gt;      lng </span>
<span class="co">#&gt; -106.437</span></code></pre></div>
<p>Which, if we only have a single point, can be equivalent to simulating data as we did above!</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html">all.equal</a></span><span class="op">(</span><span class="fu"><a href="../reference/addbuff.html">add_bbox_buffer</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">peak_bbox</span>, 
                distance <span class="op">=</span> <span class="fl">1000</span>,
                distance_unit <span class="op">=</span> <span class="st">"meters"</span><span class="op">)</span>,
          <span class="va">mt_elbert_bbox</span>,
          tolerance <span class="op">=</span> <span class="fl">0.00001</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Now that we’ve got our bounding box, it’s time to retrieve our data. terrainr currently supports downloading DEMs from the USGS 3D Elevation Program and orthoimages from the National Agricultural Imagery Program. These programs have slightly different APIs and different restrictions on file types and the size of image you can download at once. Rather than make you think about this, terrainr handles all the weird edges of the API requests for you, including splitting your bounding box into tiles and downloading each separately. To make multi-step processing easier, terrainr functions which deal with these tiles typically return lists of the file paths they saved your data to.</p>
<p>For this vignette, we’ll retrieve both elevation and orthoimagery using the <code>get_tiles</code> function. We can either use the generic “elevation” and “ortho” shorthands to get our data, or we can specify “3DEPElevation” and “USGSNAIPPlus” to make sure we’re using the same specific service – the short codes aren’t guaranteed to download data from the same service between releases!</p>
<p>One last note – all the longer-running terrainr functions can print out progress bars, if the user requests them via the <a href="https://CRAN.R-project.org/package=progressr">progressr</a> package. We’ll demonstrate that syntax here:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/progressr">progressr</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/progressr/man/handlers.html">handlers</a></span><span class="op">(</span><span class="st">"progress"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/progressr/man/with_progress.html">with_progress</a></span><span class="op">(</span>
  <span class="va">output_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_tiles.html">get_tiles</a></span><span class="op">(</span>bbox <span class="op">=</span> <span class="va">mt_elbert_bbox</span>,
                            output_prefix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span><span class="op">)</span>,
                            services <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"elevation"</span>, <span class="st">"ortho"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>And just like that, we have our data tiles!</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output_files</span></code></pre></div>
<pre><code>#&gt; $`3DEPElevation`
#&gt; [1] "/tmp/RtmphTFQvZ/file65e5d859e628_3DEPElevation_1_1.tif"
#&gt; 
#&gt; $USGSNAIPPlus
#&gt; [1] "/tmp/RtmphTFQvZ/file65e5d859e628_USGSNAIPPlus_1_1.tif"</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">output_files</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="example_dem.png" width="240"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/plotRGB.html">plotRGB</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/brick.html">brick</a></span><span class="op">(</span><span class="va">output_files</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, scale <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="example_ortho.png" width="240"></p>
<p><code>output_files</code> is now a named list with all of our downloaded files! If we were requesting more data than we can download at once, each element of the list would be a character vector containing the file paths for all of our downloaded tiles. Since we’re sticking with a relatively small area for this example, we only have one tile for each service.</p>
<p>A weird quirk of this API is that the USGS does not necessarily respect the bounding boxes that we ask for, and will download tiles with overlapping edges. We can fix this using <code>merge_rasters</code>:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">elevation_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_rasters.html">merge_rasters</a></span><span class="op">(</span>input_rasters <span class="op">=</span> <span class="va">output_files</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
                                  output_raster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>
<span class="va">ortho_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_rasters.html">merge_rasters</a></span><span class="op">(</span>input_rasters <span class="op">=</span> <span class="va">output_files</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,
                              output_raster <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><code>merge_rasters</code> can also be used to georeference multiple images based on reference rasters – so if you produce overlays for each tile you download, you can quickly and easily turn them into a single merged overlay. If you only have a single file to georeference (or don’t want to merge the outputs), check out the <code>terrainr</code> function <code>georeference_overlay</code>.</p>
<p>This can be particularly useful when producing overlay images from external data. Users are able to provide their own imagery (given it is of the same extent and resolution as the raster map) to be georeferenced and used as an overlay, or quickly produce images from vector data (in any format that can be read by the <code>sf</code> package) using the <code>vector_to_overlay</code> function:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mt_elbert_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html">st_as_sf</a></span><span class="op">(</span><span class="va">mt_elbert_points</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lng"</span>, <span class="st">"lat"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="va">mt_elbert_sf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html">st_crs</a></span><span class="op">(</span><span class="fl">4326</span><span class="op">)</span>
<span class="va">mt_elbert_overlay</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/vector_to_overlay.html">vector_to_overlay</a></span><span class="op">(</span><span class="va">mt_elbert_sf</span>,
                                       <span class="va">elevation_merged</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                                       size <span class="op">=</span> <span class="fl">15</span>,
                                       color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="va">mt_elbert_overlay</span><span class="op">)</span></code></pre></div>
<p><img src="mt_elbert_overlay.png" width="690"></p>
<p>These overlays may be stacked on top of one another or downloaded imagery using the <code>combine_overlays</code> function:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ortho_with_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/combine_overlays.html">combine_overlays</a></span><span class="op">(</span><span class="va">ortho_merged</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                                      <span class="va">mt_elbert_overlay</span>,
                                      output_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".png"</span><span class="op">)</span><span class="op">)</span>
<span class="fu">png</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/png/man/readPNG.html">readPNG</a></span><span class="op">(</span><span class="va">ortho_with_points</span><span class="op">)</span></code></pre></div>
<p><img src="combined_overlay.jpg" width="680"></p>
<p>Attempting to combine particularly large images may result in R using too much memory, possibly even crashing the R session. As a result, it is often helpful to instead create an overlay for each image tile and then merge the resuling images using <code>merge_rasters</code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tile_overlays</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">elevation_merged</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
                        <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/vector_to_overlay.html">vector_to_overlay</a></span><span class="op">(</span><span class="va">mt_elbert_sf</span>, 
                                                      <span class="va">x</span>, 
                                                      size <span class="op">=</span> <span class="fl">15</span>, 
                                                      color <span class="op">=</span> <span class="st">"red"</span>, 
                                                      na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>

<span class="va">combined_tiles</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="../reference/combine_overlays.html">combine_overlays</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, output_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".png"</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>,                            
  <span class="va">output_files</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
  <span class="va">tile_overlays</span><span class="op">)</span>

<span class="fu"><a href="../reference/merge_rasters.html">merge_rasters</a></span><span class="op">(</span>input_rasters <span class="op">=</span> <span class="va">output_files</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
              input_images <span class="op">=</span> <span class="va">combined_tiles</span><span class="op">)</span></code></pre></div>
<p>The last major function provided by terrainr is <code>raster_to_raw_tiles</code>, which is designed to turn these larger rasters into tiles that can be imported into the Unity 3D rendering engine. The specifics of working with Unity is outside of the scope of this overview vignette, other than to demonstrate the main way I call <code>raster_to_raw_tiles</code>:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">side_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">vapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">elevation_merged</span>, <span class="va">ortho_merged</span><span class="op">)</span>, 
                      <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html">raster</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, 
                      <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span><span class="op">)</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/pkg/progressr/man/with_progress.html">with_progress</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/raster_to_raw_tiles.html">raster_to_raw_tiles</a></span><span class="op">(</span>input_file <span class="op">=</span> <span class="va">x</span>, 
                        output_prefix <span class="op">=</span> <span class="st">"mt_ebert"</span>, 
                        side_length <span class="op">=</span> <span class="va">y</span>, 
                        raw <span class="op">=</span> <span class="va">z</span><span class="op">)</span>
    <span class="op">)</span>
<span class="op">}</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">elevation_merged</span>, <span class="va">ortho_merged</span><span class="op">)</span>,
  <span class="va">side_length</span>, <span class="co"># What's the longer edge of our image file?</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># we don't want to convert our orthoimages to .raw;</span>
<span class="op">)</span>                <span class="co"># Unity takes the textures as .pngs</span></code></pre></div>
<p>And after that function runs, it’s a matter of minutes to create beautiful – and fully physically-simulated – landscape visualizations of your area of interest:</p>
<p><img src="ebert_unity.jpg" width="860"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Michael Mahoney.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
